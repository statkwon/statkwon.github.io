<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>COLA - ML LAB</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="COLA" />
<meta property="og:description" content="Constant Overlap-Add Constraint To ensure successful reconstruction of nonmodified spectra, the analysis window must satisfy the COLA constraint. In general, if the analysis window satisfies the condition $\displaystyle \sum_{m=-\infty}^\infty g^{a&#43;1}(n-mR)=c,\;^\forall n\in\mathbb{Z}$, the window is considered to be COLA-compliant.
Perfect Reconstruction In general, computing the STFT of an input signal and inverting it does not result in perfect reconstruction. If you want the output of ISTFT to match the original input signal as closely as possible, the signal and the window must satisfy the following conditions:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://statkwon.github.io/speech_enhancement/cola/" /><meta property="article:section" content="speech_enhancement" />
<meta property="article:published_time" content="2023-11-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-11-28T00:00:00+00:00" />

		<meta itemprop="name" content="COLA">
<meta itemprop="description" content="Constant Overlap-Add Constraint To ensure successful reconstruction of nonmodified spectra, the analysis window must satisfy the COLA constraint. In general, if the analysis window satisfies the condition $\displaystyle \sum_{m=-\infty}^\infty g^{a&#43;1}(n-mR)=c,\;^\forall n\in\mathbb{Z}$, the window is considered to be COLA-compliant.
Perfect Reconstruction In general, computing the STFT of an input signal and inverting it does not result in perfect reconstruction. If you want the output of ISTFT to match the original input signal as closely as possible, the signal and the window must satisfy the following conditions:"><meta itemprop="datePublished" content="2023-11-28T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-11-28T00:00:00+00:00" />
<meta itemprop="wordCount" content="416">
<meta itemprop="keywords" content="STFT,COLA," />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="INTUITIVE STATISTICAL LEARNING" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">INTUITIVE STATISTICAL LEARNING</div>
					<div class="logo__tagline">Wanna be a Skillful Data Scientist</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">COLA</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2023-11-28T00:00:00Z">2023-11-28</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/speech-enhancement/" rel="category">Speech Enhancement</a>
	</span>
</div></div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#constant-overlap-add-constraint">Constant Overlap-Add Constraint</a></li>
    <li><a href="#perfect-reconstruction">Perfect Reconstruction</a></li>
    <li><a href="#python-code-for-example">Python Code for Example</a>
      <ul>
        <li><a href="#cola-non-compliant-window">COLA-non-compliant Window</a></li>
        <li><a href="#cola-compliant-window">COLA-compliant Window</a></li>
        <li><a href="#application">Application</a></li>
      </ul>
    </li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h2 id="constant-overlap-add-constraint">Constant Overlap-Add Constraint</h2>
<p>To ensure successful reconstruction of nonmodified spectra, the analysis window must satisfy the COLA constraint. In general, if the analysis window satisfies the condition $\displaystyle \sum_{m=-\infty}^\infty g^{a+1}(n-mR)=c,\;^\forall n\in\mathbb{Z}$, the window is considered to be COLA-compliant.</p>
<h2 id="perfect-reconstruction">Perfect Reconstruction</h2>
<p>In general, computing the STFT of an input signal and inverting it does not result in perfect reconstruction. If you want the output of ISTFT to match the original input signal as closely as possible, the signal and the window must satisfy the following conditions:</p>
<ul>
<li>Input size - If you invert the output of stft using istft and want the result to be the same length as the input signal $x$, the value of $k=\dfrac{N_x-L}{M-L}$ must be an integer. In the equation, $N_x$ is the length of the signal, $M$ is the length of the window, and $L$ is the overlap length.</li>
<li>COLA compliance - Use COLA-compliant windows, assuming that you have not modified the short-time Fourier transform of the signal.</li>
<li>Padding - If the length of the input signal is such that the value of $k$ is not an integer, zero-pad the signal before computing the short-time Fourier transform. Remove the extra zeros after inverting the signal.</li>
</ul>
<h2 id="python-code-for-example">Python Code for Example</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">import</span> scipy <span style="color:#66d9ef">as</span> sp
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> soundfile <span style="color:#66d9ef">as</span> sf
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span></code></pre></div><h3 id="cola-non-compliant-window">COLA-non-compliant Window</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>HOP_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>WIN_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span>NUM_WINDOWS <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>window <span style="color:#f92672">=</span> sp<span style="color:#f92672">.</span>signal<span style="color:#f92672">.</span>windows<span style="color:#f92672">.</span>hann(WIN_LEN, sym<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>sp<span style="color:#f92672">.</span>signal<span style="color:#f92672">.</span>check_COLA(window, WIN_LEN, WIN_LEN <span style="color:#f92672">-</span> HOP_LEN) <span style="color:#75715e"># False</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>window_add <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(HOP_LEN <span style="color:#f92672">*</span> NUM_WINDOWS <span style="color:#f92672">+</span> WIN_LEN <span style="color:#f92672">-</span> HOP_LEN)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">3.5</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(NUM_WINDOWS):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(np<span style="color:#f92672">.</span>arange(HOP_LEN <span style="color:#f92672">*</span> i, HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> WIN_LEN), window, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(WIN_LEN):
</span></span><span style="display:flex;"><span>        window_add[HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">+=</span> window[j]
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>plot(window_add, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/speech_enhancement/cola1.png" width="800"/>
</figure>

<h3 id="cola-compliant-window">COLA-compliant Window</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>HOP_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>WIN_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>
</span></span><span style="display:flex;"><span>NUM_WINDOWS <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>window <span style="color:#f92672">=</span> sp<span style="color:#f92672">.</span>signal<span style="color:#f92672">.</span>windows<span style="color:#f92672">.</span>hann(WIN_LEN, sym<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>sp<span style="color:#f92672">.</span>signal<span style="color:#f92672">.</span>check_COLA(window, WIN_LEN, WIN_LEN <span style="color:#f92672">-</span> HOP_LEN) <span style="color:#75715e"># True</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>window_add <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(HOP_LEN <span style="color:#f92672">*</span> NUM_WINDOWS <span style="color:#f92672">+</span> WIN_LEN <span style="color:#f92672">-</span> HOP_LEN)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">3.5</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(NUM_WINDOWS):
</span></span><span style="display:flex;"><span>    ax<span style="color:#f92672">.</span>plot(np<span style="color:#f92672">.</span>arange(HOP_LEN <span style="color:#f92672">*</span> i, HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> WIN_LEN), window, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(WIN_LEN):
</span></span><span style="display:flex;"><span>        window_add[HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">+=</span> window[j]
</span></span><span style="display:flex;"><span>ax<span style="color:#f92672">.</span>plot(window_add, c<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/speech_enhancement/cola2.png" width="800"/>
</figure>

<h3 id="application">Application</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>HOP_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">160</span>
</span></span><span style="display:flex;"><span>WIN_LEN <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>
</span></span><span style="display:flex;"><span>NUM_WINDOWS <span style="color:#f92672">=</span> <span style="color:#ae81ff">160000</span> <span style="color:#f92672">//</span> HOP_LEN
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>signal, sr <span style="color:#f92672">=</span> sf<span style="color:#f92672">.</span>read(<span style="color:#e6db74">&#34;clnsp113_car_19980_0_snr18_tl-30_fileid_178.wav&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>signal_add <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(len(signal))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(NUM_WINDOWS):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(WIN_LEN):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j <span style="color:#f92672">&gt;=</span> len(signal):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        signal_add[HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">+=</span> signal[HOP_LEN <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">*</span> window[j]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">8</span>), sharey<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>plot(signal, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Original&#34;</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>plot(signal_add <span style="color:#f92672">/</span> <span style="color:#ae81ff">1.5</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>ax[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;Reconstructed&#34;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><figure><img src="/speech_enhancement/cola3.png" width="800"/>
</figure>

<hr>
<p><strong>Reference</strong></p>
<ol>
<li><a href="https://www.mathworks.com/help/signal/ref/stft.html">https://www.mathworks.com/help/signal/ref/stft.html</a></li>
<li><a href="https://www.mathworks.com/help/signal/ref/istft.html">https://www.mathworks.com/help/signal/ref/istft.html</a></li>
<li><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.check_COLA.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.check_COLA.html</a></li>
</ol>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/stft/" rel="tag">STFT</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/cola/" rel="tag">COLA</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="STATKWON avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About STATKWON</span>
	</div>
	<div class="authorbox__description">
		Wanna be a Skillful Data Scientist
	</div>
</div>


<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "statkwon" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 STATKWON.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\[','\]']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
        }
    });
    MathJax.Hub.Queue(function() {
        
        
        
        var all = MathJax.Hub.getAllJax(), i;
        for(i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

</body>
</html>